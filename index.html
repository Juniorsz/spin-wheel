<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7">
	<title>DUMUCER LUCKY SPIN WHEEL</title>
	<link href="https://fonts.googleapis.com/css?family=Muli|Open+Sans" rel="stylesheet">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<link href="https://cdnjs.cloudflare.com/ajax/libs/meyer-reset/2.0/reset.css" type="text/css" rel="stylesheet">
	<!-- UIkit CSS -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.0.0-rc.10/css/uikit.min.css" />

<!-- UIkit JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.0.0-rc.10/js/uikit.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.0.0-rc.10/js/uikit-icons.min.js"></script>
	<link rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/animate.css@3.5.2/animate.min.css"
  integrity="sha384-OHBBOqpYHNsIqQy8hL1U+8OXf9hH6QRxi0+EODezv82DfnZoV7qoHAZDwMwEJvSw"
  crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/all.css" integrity="sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ" crossorigin="anonymous">
  <!-- or -->
  <link rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css"
  integrity="sha384-OHBBOqpYHNsIqQy8hL1U+8OXf9hH6QRxi0+EODezv82DfnZoV7qoHAZDwMwEJvSw"
  crossorigin="anonymous">
  <script>
	  $('#nguoitrungthuong').animate({
        scrollTop: $('#nguoitrungthuong')[0].scrollHeight}, 2000);
  </script>
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
	<script type="text/javascript">
		var token = 'EAAAAUaZA8jlABAIYy5ZAUa3SUTyWpdjrFSoSYDAxhywjN7a9ZBnqVrYcU61mpbVEB5oyESMyTDO3fyQhFNCrcH4K8eSRBZCBrEgctILtKL7vS7hONi890WdA6ktw5eArVsEzspCUuuqpQkZBFql8sn6kJ6XAP5hTZCvdMVwkkOfQZDZD';
		var postid = '523670158084055';
		var danhsach = [];
		shuffle = function(o) {
			for ( var j, x, i = o.length; i; j = parseInt(Math.random() * i), x = o[--i], o[i] = o[j], o[j] = x)
				;
			return o;
		};

		String.prototype.hashCode = function(){
		// See http://www.cse.yorku.ca/~oz/hash.html		
		var hash = 5381;
		for (i = 0; i < this.length; i++) {
			char = this.charCodeAt(i);
			hash = ((hash<<5)+hash) + char;
			hash = hash & hash; // Convert to 32bit integer
		}
		return hash;
	}

	Number.prototype.mod = function(n) {
		return ((this%n)+n)%n;
	}</script>
	<script type="text/javascript">
		venues = {
			"101161"  : "1000 PEW COINS",
			"1"  : "1000 PEW COINS",
			"512060"  : "1000 PEW COINS",
			"66244"   : "1000 PEW COINS",
			"352867"  : "1000 PEW COINS",
			"22493"   : "1000 PEW COINS",
			"268052"  : "THÊM LƯỢT",
			"5665"    : "1000 PEW COINS",
			"224930"    : "AHIHI :)))",
			"257424"  : "1 CÁI ĐẤM",
			"56652"    : "GẦN TRÚNG RỒI",
			"35286"    : "0 PEW COINS",
			"1011612"  : "1 CÁI TÁT",
			"10111"  : "FUCKING WOW SHIT"
		};

		$(function() {

			var venueContainer = $('#venues ul');
			$.each(venues, function(key, item) {
				venueContainer.append(
					$(document.createElement("li"))
					.append(
						$(document.createElement("input")).attr({
							id:    'venue-' + key
							,name:  item
							,value: item
							,type:  'checkbox'
							,checked:true
						})
						.change( function() {
							var cbox = $(this)[0];
							var segments = wheel.segments;
							var i = segments.indexOf(cbox.value);

							if (cbox.checked && i == -1) {
								segments.push(cbox.value);

							} else if ( !cbox.checked && i != -1 ) {
								segments.splice(i, 1);
							}

							segments.sort();
							wheel.update();
						} )

						).append(
						$(document.createElement('label')).attr({
							'for':  'venue-' + key
						})
						.text( item )
						)
						)
			});

		//$('#venues ul>li').tsort("input", {attr: "value"});
	});
</script>
	<script type="text/javascript">// WHEEL!
	var wheel = {

		timerHandle : 0,
		timerDelay : 33,

		angleCurrent : 0,
		angleDelta : 0,

		size : 290,
		n:0,
		m:0,
		canvasContext : null,
		ketqua:'',
		colors : [ '#f9a31d', '#f79420', '#f48322', '#f48021', '#f26c21', '#f05622',
		'#ee3a24'],
		segments : [],

		seg_colors : [], // Cache of segments to colors
		
		maxSpeed : Math.PI / 16,

		upTime : 1000, // How long to spin up for (in ms)
		downTime : 5000, // How long to slow down for (in ms)

		spinStart : 0,

		frames : 0,

		centerX : 300,
		centerY : 300,

		spin : function() {
			if (wheel.timerHandle == 0 && wheel.n < danhsach.length ) {
				wheel.spinStart = new Date().getTime();
				wheel.maxSpeed = Math.PI / (16 + Math.random()); // Randomly vary how hard the spin is
				wheel.frames = 0;
				wheel.n = wheel.n+1;
				wheel.m = wheel.m+1;
				wheel.sound.play();
				quaytay(wheel.n);
				wheel.timerHandle = setInterval(wheel.onTimerTick, wheel.timerDelay);
			}
			else{				
				$('#nguoitrungthuong2').html("<p>"+wheel.ketqua+"</p>");
				$('.uk-button').click();
			}

		},

		onTimerTick : function() {

			wheel.frames++;

			wheel.draw();

			var duration = (new Date().getTime() - wheel.spinStart);
			var progress = 0;
			var finished = false;

			if (duration < wheel.upTime) {
				progress = duration / wheel.upTime;
				wheel.angleDelta = wheel.maxSpeed
				* Math.sin(progress * Math.PI / 2);
			} else {
				progress = duration / wheel.downTime;
				wheel.angleDelta = wheel.maxSpeed
				* Math.sin(progress * Math.PI / 2 + Math.PI / 2);
				if (progress >= 1)
					finished = true;
			}

			wheel.angleCurrent += wheel.angleDelta;
			while (wheel.angleCurrent >= Math.PI * 2)
				// Keep the angle in a reasonable range
			wheel.angleCurrent -= Math.PI * 2;

			if (finished) {
				clearInterval(wheel.timerHandle);
				wheel.timerHandle = 0;
				wheel.angleDelta = 0;
				$("#counter").html((wheel.frames / duration * 1000) + " FPS");
				var i = wheel.segments.length - Math.floor((wheel.angleCurrent / (Math.PI * 2))	* wheel.segments.length) - 1;
				if(wheel.segments[i]=='FUCKING WOW SHIT'){
					wheel.sound2.play();
				}
				if(wheel.segments[i]=='1000 PEW COINS'){
					var data =  {
						message:'Chúc mừng',
						access_token: 	token
					}
					$.ajax({
						url: 'https://graph.facebook.com/v2.9/'+danhsach[wheel.n-1].id+'/comments',
						type: 'POST',
						dataType: 'json',
						data: data
					})
					.done(function(response) {

					})
					wheel.ketqua+='<p width="100%" style="display:block">'+'<div class="bj" style="width:10000px"><img src="https://graph.facebook.com/'+danhsach[wheel.n-1].from.id+'/picture?height=30&width=30" style="padding:5px;float:left;border-radius:50%;margin-top:-4px;" /><div style="line-height:28px;margin-bottom:5px;margin-right:10px;">'+danhsach[wheel.n - 1].from.name+' ( '+danhsach[wheel.n - 1].from.id+' )</div></div></p>';
				}
				if(wheel.segments[i]=='THÊM LƯỢT'){
					wheel.n -= 1;
				}
				setTimeout(function() {
					wheel.spin();
				}, parseInt(3000));

			}


		},

		init : function(optionList) {
			try {
				wheel.initWheel();
				wheel.initAudio();
				//wheel.initAudio2();
				wheel.initCanvas();
				wheel.draw();

				$.extend(wheel, optionList);

			} catch (exceptionData) {
				alert('Wheel is not loaded ' + exceptionData);
			}

		},

		initAudio : function() {
			var sound = document.createElement('audio');
			//sound.setAttribute('src', 'wheel.mp3');

			wheel.sound = sound;
			var sound2 = document.createElement('audio');
			sound2.setAttribute('src', 'dmm.mp3');
			wheel.sound2 = sound2;
		},
		initCanvas : function() {
			var canvas = $('#wheel #canvas').get(0);

			if ($.browser.msie) {
				canvas = document.createElement('canvas');
				$(canvas).attr('width', 1000).attr('height', 600).attr('id', 'canvas').appendTo('.wheel');
				canvas = G_vmlCanvasManager.initElement(canvas);
			}

			canvas.addEventListener("click", wheel.spin, false);
			wheel.canvasContext = canvas.getContext("2d");
		},

		initWheel : function() {
			shuffle(wheel.colors);
		},

		// Called when segments have changed
		update : function() {
			// Ensure we start mid way on a item
			//var r = Math.floor(Math.random() * wheel.segments.length);
			var r = 0;
			wheel.angleCurrent = ((r + 0.5) / wheel.segments.length) * Math.PI * 2;

			var segments = wheel.segments;
			var len      = segments.length;
			var colors   = wheel.colors;
			var colorLen = colors.length;

			// Generate a color cache (so we have consistant coloring)
			var seg_color = new Array();
			for (var i = 0; i < len; i++)
				seg_color.push( colors [ segments[i].hashCode().mod(colorLen) ] );

			wheel.seg_color = seg_color;

			wheel.draw();
		},

		draw : function() {
			wheel.clear();
			wheel.drawWheel();
			wheel.drawNeedle();
		},

		clear : function() {
			var ctx = wheel.canvasContext;
			ctx.clearRect(0, 0, 1000, 800);
		},

		drawNeedle : function() {
			var ctx = wheel.canvasContext;
			var centerX = wheel.centerX;
			var centerY = wheel.centerY;
			var size = wheel.size;

			ctx.lineWidth = 1;
			ctx.strokeStyle = 'transparent';
			ctx.fileStyle = '#ffffff';

			ctx.beginPath();

			ctx.moveTo(centerX + size - 40, centerY);
			ctx.lineTo(centerX + size + 20, centerY - 10);
			ctx.lineTo(centerX + size + 20, centerY + 10);
			ctx.closePath();

			ctx.stroke();
			ctx.fill();

			// Which segment is being pointed to?
			var i = wheel.segments.length - Math.floor((wheel.angleCurrent / (Math.PI * 2))	* wheel.segments.length) - 1;

			// Now draw the winning name
			ctx.textAlign = "left";
			ctx.textBaseline = "middle";
			ctx.fillStyle = '#ff00ff';
			ctx.font = "16px Open sans";
			ctx.fillText(wheel.segments[i], centerX + size + 25, centerY);
		},

		drawSegment : function(key, lastAngle, angle) {
			var ctx = wheel.canvasContext;
			var centerX = wheel.centerX;
			var centerY = wheel.centerY;
			var size = wheel.size;

			var segments = wheel.segments;
			var len = wheel.segments.length;
			var colors = wheel.seg_color;

			var value = segments[key];
			
			ctx.save();
			ctx.beginPath();

			// Start in the centre
			ctx.moveTo(centerX, centerY);
			ctx.arc(centerX, centerY, size, lastAngle, angle, false); // Draw a arc around the edge
			ctx.lineTo(centerX, centerY); // Now draw a line back to the centre

			// Clip anything that follows to this area
			//ctx.clip(); // It would be best to clip, but we can double performance without it
			ctx.closePath();

			ctx.fillStyle = colors[key];
			ctx.fill();
			ctx.stroke();

			// Now draw the text
			ctx.save(); // The save ensures this works on Android devices
			ctx.translate(centerX, centerY);
			ctx.rotate((lastAngle + angle) / 2);

			ctx.fillStyle = '#e4e2e2';
			ctx.fillText(value.substr(0, 20), size / 2 + 20, 0);
			ctx.restore();

			ctx.restore();
		},

		drawWheel : function() {
			var ctx = wheel.canvasContext;

			var angleCurrent = wheel.angleCurrent;
			var lastAngle    = angleCurrent;

			var segments  = wheel.segments;
			var len       = wheel.segments.length;
			var colors    = wheel.colors;
			var colorsLen = wheel.colors.length;

			var centerX = wheel.centerX;
			var centerY = wheel.centerY;
			var size    = wheel.size;

			var PI2 = Math.PI * 2;

			ctx.lineWidth    = 1;
			ctx.strokeStyle  = '';
			ctx.textBaseline = "middle";
			ctx.textAlign    = "center";
			ctx.font         = "1.4em Open sans";

			for (var i = 1; i <= len; i++) {
				var angle = PI2 * (i / len) + angleCurrent;
				wheel.drawSegment(i - 1, lastAngle, angle);
				lastAngle = angle;
			}
			// Draw a center circle
			ctx.beginPath();
			ctx.arc(centerX, centerY, 35, 0, PI2, false);
			ctx.closePath();

			ctx.fillStyle   = '#e4e2e2';
			ctx.strokeStyle = '#ffff';
			ctx.fill();
			ctx.stroke();

			// Draw outer circle
			ctx.beginPath();
			ctx.arc(centerX, centerY, size, 0, PI2, false);
			ctx.closePath();

			ctx.lineWidth   = 10;
			ctx.strokeStyle = '#e4e2e2';
			ctx.stroke();
		},
	}

	window.onload = function() {
		wheel.init();

		var segments = new Array();
		$.each($('#venues input:checked'), function(key, cbox) {
			segments.push( cbox.value );
		});

		wheel.segments = segments;
		wheel.update();

		// Hide the address bar (for mobile devices)!
		setTimeout(function() {
			window.scrollTo(0, 1);
			//canvas.addEventListener("click", wheel.spin, false);
		}, 0);
		// setTimeout(function() {
			

		// }, parseInt(60000));
	}
	function quaytay(i){
		if(danhsach[i-1]){
			$('#nguoitrungthuong').html(wheel.ketqua);
			$('#vongquay1').html('<div style="display:block"><div><div style="clear:both"></div><div style="display:block;overflow:hidden"><span class="imgthumb"><img style="border-radius:50%" src="https://graph.facebook.com/'+danhsach[i-1].from.id+'/picture?height=50&width=50"   /></span><span style="float:left;line-height:50px"> <b>'+danhsach[i-1].from.name+'</b></span></div>');
			$('#comment').text(danhsach[i-1].message);
			$('#vongquay').html('Lượt quay số : '+ parseInt(wheel.m));

		}		
	}
</script></head><body style="background:#c43f20;z-index: -1;background-position: center;background-repeat: no-repeat;background-size: 100%">
	<div id="stargame" style="overflow: hidden">
		<div style="text-align: center;">
			<img width="20%" style='margin-top:20px;margin-right: -350px;margin-bottom:10px' src="https://au.vtcgame.vn/vongquayau/images/text_vongquay.png"></div>
			<p id="demo" style="position:absolute;text-align: center;margin-left:730px;font-weight: bold;font-size: 15px;color:#fff;top: 110px;"></p>
			<div style="clear: both;"></div>
			<div id="venues" style="float:left;display: none;margin-top: 10px;z-index: 999999 !important;">
				<ul>

				</ul>
			</div>
			<div style='left: 1115px;top: 378px;width: 200px;height: 50px;background: #c43f20;z-index: 1;' class='ab'></div>
			<img style='left: 500px;top: 500px' class='ab' src='https://image.flaticon.com/icons/svg/138/138358.svg'>
			<img style='left: 600px;top: 100px' class='ab' src='https://image.flaticon.com/icons/svg/448/448014.svg'>
			<img style='left: 850px;top: 368px;width:50px;transform:rotate(-90deg)' class='ab spin' src='http://choi68.com/res/vongquay/images/btn-tro.png'>
			<img style='left: 1050px;top: 100px' class='ab' src='https://image.flaticon.com/icons/svg/263/263399.svg'>
			<div id="danhsach" style="">
				<div style="padding: 10px;z-index: 99999999;">
					<p style='margin-bottom:8px;z-index: 999999999999;font-size: 13px;' id="tongluot"></p>
					<p style='margin-bottom:8px;font-size: 13px;margin-top: 0px;' id="vongquay"></p>
					<p style='margin-bottom:8px;font-size: 13px;margin-top: 0' id="vongquay1"></p>
					<div style="clear: both;"></div>
					<p style='margin-bottom:8px;padding: 20px;
					border-radius: 10px;
					color: #ffff;
					margin-bottom: 8px;
					background-color: #673695;font-size: 13px;' id=""><i class="fas fa-comment-alt"></i> : <qoutes><span id="comment"></span></qoutes></p>
					<div style="clear: both;"></div>
					<div id="nguoitrungthuong1">
						<h5 style="font-weight: bold;margin: 10px 0px;width: 100%;padding-bottom: 10px">WINNER CHICKEN DINNER</h5>
						<div style="clear: both;"></div>
						<div id="nguoitrungthuong" style='height:370px;overflow-y: scroll;overflow-x:hidden;font-size: 13px;'></div>
					</div>
				</div>
			</div>
			<div id="wheel" style="float: left;width: 73%;min-width: 73%;z-index: 9999999;"><canvas id="canvas" width="950" height="600" style="z-index: 999999;"></canvas></div>

		</div>

		<script>
// Set the date we're counting down to
var countDownDate = new Date("Aug 22, 2018 19:40:00").getTime();

// Update the count down every 1 second
var x = setInterval(function() {

    // Get todays date and time
    var now = new Date().getTime();
    
    // Find the distance between now an the count down date
    var distance = countDownDate - now;
    
    // Time calculations for days, hours, minutes and seconds
    var days = Math.floor(distance / (1000 * 60 * 60 * 24));
    var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
    var seconds = Math.floor((distance % (1000 * 60)) / 1000);
    
    // Output the result in an element with id="demo"
    document.getElementById("demo").innerHTML = "Bắt đầu sau: "+days + " ngày " + hours + " giờ "
    + minutes + " phút " + seconds + " giây ";
    
    // If the count down is over, write some text 
    if (distance < 0) {
    	clearInterval(x);
    	document.getElementById("demo").innerHTML = "";
    	$.ajax({
    		url: 'https://graph.facebook.com/v2.9/'+postid+'/comments?limit=1000&access_token='+token,
    		type: 'GET',
    		dataType: 'json',
    	})
    	.done(function(response) {
    		if (!response || response.error) {
    			location.reload()
    		}
    		else{
    			danhsach = response.data;
    			//console.log(danhsach);
    			//wheel.spin();
    			$('#tongluot').html('Số bình luận : '+ danhsach.length);
    			setTimeout(function() {
    				wheel.spin();
    			}, parseInt(1000));
    			//console.log(danhsach[1].from.name);
    		}
    	})
    } 
}, 1000);
</script>

<style>
body{
	font-family: 'Open sans', sans-serif !important;
}
 .ab{
	 position: absolute;
	 width: 80px;
 }
.imgthumb{
	padding: 2px;
	float: left;
	margin-right: 5px;
}
.imgthumb img{
	width: 32px;
	height: auto;
	margin-top: 10px;
}
#canvas{
	width: 80%;
	font-family: 'Open sans', sans-serif !important;
	margin:auto;
	margin-left: 250px;
	letter-spacing: 1px;
	margin-top: 25px;
	text-shadow: 2px 2px #fff;
	z-index: 999999;
}
#demo{
	font-size: 15px;
}
#danhsach{
	position: relative;
	top: -110px;
	left: 20px;
	color: #365899 !important;
	float:left;
	display:block;width: 27%;
	max-width: 27%; 
	background: #f2f2f2;
	border-bottom: 8px solid #ccc;
	border-top: 5px solid #ffff;
	border-radius: 10px;
	height: 605px;
}
</style>
<!-- This is a button toggling the modal -->
<button style='display: none' class="uk-button uk-button-default uk-margin-small-right" type="button" uk-toggle="target: #modal-example">Open</button>
<!-- This is the modal -->
<div id="modal-example" uk-modal>
    <div class="uk-modal-dialog uk-modal-body">
        <p id="nguoitrungthuong2"></p>
    </div>
</div>
</body></html>